<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Son Defter</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      line-height: 1.6;
      padding: 10px;
    }
    .header {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      color: #2c3e50;
      padding: 40px 20px;
      text-align: center;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }
    .header h1 { font-size: 42px; margin-bottom: 10px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .header p { font-size: 18px; color: #64748b; }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 10px;
    }
    .entry-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      padding: 30px;
      margin-bottom: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-left: 5px solid #667eea;
      transition: all 0.3s;
    }
    .entry-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    .entry-card h2 {
      color: #1e293b;
      margin-bottom: 15px;
      font-size: 26px;
      font-weight: 700;
    }
    .entry-meta {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .entry-meta span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .entry-content {
      color: #475569;
      font-size: 16px;
      line-height: 1.8;
      word-wrap: break-word;
    }
    .entry-content img {
      max-width: 100%;
      height: auto;
      border-radius: 12px;
      margin: 15px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .entry-content.collapsed {
      max-height: 300px;
      overflow: hidden;
      position: relative;
    }
    .entry-content.collapsed::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(transparent, rgba(255,255,255,0.98));
    }
    .read-more-btn {
      margin-top: 15px;
      padding: 10px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(102,126,234,0.3);
    }
    .read-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102,126,234,0.4);
    }
    .no-entries {
      text-align: center;
      padding: 60px 30px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .no-entries h2 {
      color: #64748b;
      font-size: 26px;
      margin-bottom: 12px;
      font-weight: 600;
    }
    .no-entries p {
      color: #94a3b8;
      font-size: 16px;
    }
    .login-link {
      text-align: center;
      margin-top: 25px;
      margin-bottom: 25px;
    }
    .login-link a {
      display: inline-block;
      padding: 12px 30px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      color: #667eea;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .login-link a:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    .badge {
      display: inline-block;
      padding: 5px 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(102,126,234,0.3);
    }
    .private-badge {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    .tabs-container {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .tab-list {
      list-style: none;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .tab-item {
      padding: 12px 24px;
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      color: #1e293b;
      font-weight: 600;
      border: 2px solid transparent;
    }
    .tab-item:hover {
      background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
      transform: translateY(-2px);
    }
    .tab-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: rgba(255,255,255,0.3);
      box-shadow: 0 4px 12px rgba(102,126,234,0.3);
    }
    .pages-sidebar {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .pages-sidebar h3 {
      color: #1e293b;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 15px;
    }
    .page-list {
      list-style: none;
    }
    .page-item {
      padding: 12px 16px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 10px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.3s;
      color: #1e293b;
      font-weight: 500;
      border: 2px solid transparent;
    }
    .page-item:hover {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
      transform: translateX(5px);
    }
    .page-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: rgba(255,255,255,0.3);
    }
    .content-wrapper {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .sidebar-wrapper {
      width: 100%;
      max-width: 280px;
      position: sticky;
      top: 20px;
    }
    .entries-wrapper {
      flex: 1;
      min-width: 300px;
    }

    @media (max-width: 768px) {
      body { padding: 5px; }
      .header { padding: 25px 15px; }
      .header h1 { font-size: 32px; }
      .header p { font-size: 16px; }
      .entry-card { padding: 20px; }
      .entry-card h2 { font-size: 22px; }
      .content-wrapper { flex-direction: column; }
      .sidebar-wrapper { max-width: 100%; position: static; }
      .tabs-container { padding: 15px; }
      .pages-sidebar { padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìñ Son Defter</h1>
    <p>Ki≈üisel g√ºnl√ºk defterim</p>
  </div>

  <div class="container">
    <div class="tabs-container">
      <ul class="tab-list" id="tabList"></ul>
    </div>

    <div class="content-wrapper">
      <div class="sidebar-wrapper">
        <div class="pages-sidebar">
          <h3>üìÑ Sayfalar</h3>
          <ul class="page-list" id="pageList"></ul>
        </div>
        <div class="login-link">
          <a href="/login.html">Giri≈ü Yap</a>
        </div>
      </div>

      <div class="entries-wrapper">
        <div id="entriesContainer"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';
    let allEntries = [];
    let selectedTabId = null;
    let selectedPageId = null;

    async function loadData() {
      try {
        const token = localStorage.getItem('token');
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

        // Load tabs
        const tabsResponse = await fetch(`${API_URL}/tabs`, token ? { headers } : {});
        const tabs = token ? await tabsResponse.json() : [];

        // Load all entries
        const entriesResponse = await fetch(`${API_URL}/entries/public/all`, { headers });
        allEntries = await entriesResponse.json();

        renderTabs(tabs);

        // Auto-select first tab if available
        if (tabs.length > 0) {
          await selectTab(tabs[0].id);
        } else {
          renderEntries(allEntries);
        }
      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('entriesContainer').innerHTML = `
          <div class="no-entries">
            <h2>‚ö†Ô∏è Baƒülantƒ± Hatasƒ±</h2>
            <p>Sunucuya baƒülanƒ±lamƒ±yor. L√ºtfen daha sonra tekrar deneyin.</p>
          </div>
        `;
      }
    }

    function renderTabs(tabs) {
      const tabList = document.getElementById('tabList');
      if (tabs.length === 0) {
        tabList.innerHTML = '<li style="padding: 10px; color: #7f8c8d;">Hen√ºz sekme yok</li>';
        return;
      }

      tabList.innerHTML = '';
      tabs.forEach(tab => {
        const li = document.createElement('li');
        li.className = 'tab-item' + (tab.id === selectedTabId ? ' active' : '');
        li.textContent = tab.name;
        li.onclick = () => selectTab(tab.id);
        tabList.appendChild(li);
      });
    }

    async function selectTab(tabId) {
      selectedTabId = tabId;
      selectedPageId = null;

      // Reload tabs to update active state
      const token = localStorage.getItem('token');
      const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
      const tabsResponse = await fetch(`${API_URL}/tabs`, token ? { headers } : {});
      const tabs = token ? await tabsResponse.json() : [];
      renderTabs(tabs);

      // Load pages for selected tab
      const pagesResponse = await fetch(`${API_URL}/pages/${tabId}`, token ? { headers } : {});
      const pages = token ? await pagesResponse.json() : [];
      renderPages(pages);

      // Filter entries by tab
      const filteredEntries = allEntries.filter(e => e.tab_name === tabs.find(t => t.id === tabId)?.name);
      renderEntries(filteredEntries);
    }

    function renderPages(pages) {
      const pageList = document.getElementById('pageList');
      if (pages.length === 0) {
        pageList.innerHTML = '<li style="padding: 10px; color: #7f8c8d;">Sayfa se√ßin</li>';
        return;
      }

      pageList.innerHTML = '';
      pages.forEach((page, index) => {
        const li = document.createElement('li');
        li.className = 'page-item' + (page.id === selectedPageId ? ' active' : '');
        li.textContent = page.name;
        li.onclick = () => selectPage(page.id, page.name);
        pageList.appendChild(li);
      });

      // Auto-select first page
      if (pages.length > 0 && !selectedPageId) {
        selectPage(pages[0].id, pages[0].name);
      }
    }

    function selectPage(pageId, pageName) {
      selectedPageId = pageId;

      // Update page list active state
      document.querySelectorAll('.page-item').forEach(item => {
        item.classList.remove('active');
        if (item.textContent === pageName) {
          item.classList.add('active');
        }
      });

      // Filter entries by page
      const filteredEntries = allEntries.filter(e => e.page_name === pageName);
      renderEntries(filteredEntries);
    }

    function renderEntries(entries) {
      const container = document.getElementById('entriesContainer');

      if (entries.length === 0) {
        container.innerHTML = `
          <div class="no-entries">
            <h2>üîí Hen√ºz Girdi Yok</h2>
            <p>Bu b√∂l√ºmde hen√ºz g√ºnl√ºk girdisi bulunmuyor.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = '';
      entries.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'entry-card';

        const date = new Date(entry.created_at);
        const formattedDate = date.toLocaleDateString('tr-TR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        const privacyBadge = entry.is_public
          ? ''
          : '<span class="badge private-badge">üîí √ñzel</span> ';

        const isLong = entry.content.length > 500;
        const contentClass = isLong ? 'entry-content collapsed' : 'entry-content';
        const readMoreBtn = isLong ? '<button class="read-more-btn" onclick="toggleContent(this)">Devamƒ±nƒ± Oku</button>' : '';

        card.innerHTML = `
          <h2>${entry.title}</h2>
          <div class="entry-meta">
            <span>üìÖ ${formattedDate}</span>
            <span>${privacyBadge}<span class="badge">${entry.tab_name}</span> ‚Üí ${entry.page_name}</span>
          </div>
          <div class="${contentClass}">${entry.content}</div>
          ${readMoreBtn}
        `;

        container.appendChild(card);
      });
    }

    function toggleContent(btn) {
      const contentDiv = btn.previousElementSibling;
      if (contentDiv.classList.contains('collapsed')) {
        contentDiv.classList.remove('collapsed');
        btn.textContent = 'Daha Az G√∂ster';
      } else {
        contentDiv.classList.add('collapsed');
        btn.textContent = 'Devamƒ±nƒ± Oku';
      }
    }

    loadData();
  </script>
</body>
</html>
